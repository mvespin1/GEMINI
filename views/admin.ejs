<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <!-- Incluye los archivos CSS de DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
    <h1>Admin Panel</h1>
    <!-- Agrega una tabla con un ID para DataTables -->
    <table id="preguntasTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Pregunta</th>
                <th>Respuesta</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los datos se llenarán dinámicamente aquí -->
        </tbody>
    </table>

    <!-- Incluye los archivos JS de jQuery y DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

    <script>
        $(document).ready(function() {
            $('#preguntasTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/api/preguntas", // Esta es la ruta donde obtendrás los datos del servidor
                "columns": [
                    { "data": "id" },
                    { "data": "pregunta" },
                    { "data": "respuesta" }
                ]
            });

            const dataTableOptions = {
                scrollCollapse: true,
                lengthMenu: [
                    [100, 200, 300, 400, 500, 600, 700, 800, 900, 1000],
                    [100, 200, 300, 400, 500, 600, 700, 800, 900, 1000]
                ],
                pageLength: 100,
                destroy: true,
                autoWidth: true,
                language: {
                    lengthMenu: "Mostrar MENU registros por página",
                    zeroRecords: "Ningún usuario encontrado",
                    info: "Mostrando de START a END de un total de TOTAL registros",
                    infoEmpty: "Ningún usuario encontrado",
                    infoFiltered: "(filtrados desde MAX registros totales)",
                    search: "Buscar:",
                    loadingRecords: "Cargando...",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior"
                    }
                }
            };

            const listUsers = async () => {
                try {
                    const response = await fetch("./backend/conexion.php"); 
                    const users = await response.json();
                    let content = ``;
                    users.forEach((user, index) => {
                        content += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${user.nombre}</td>
                                <td>${user.extension_telefono}</td>
                            </tr>`;
                    });
                    $('#preguntasTable tbody').html(content);
                } catch (ex) {
                    console.error(ex);
                }
            };

            listUsers();
        });
    </script>
</body>
</html>
